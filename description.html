<!DOCTYPE html>
<html>

  <head>
    <script type="text/javascript"
            src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Dynaphopy : Phonon Analysis from Dynamical Data">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Dynaphopy</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <h2 id="project_tagline">Features description</h2>

        </header>
    </div>
    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
    	<section id="main_content" class="inner">

<a href="index.html"><div id="backbutton" s style="position:relative;right:-580px;top:-170px;width:60px"><body>Back</body></div></a>


<h3>Introduction</h3>
<p>
DynaPhoPy calculates the phonon linewidths and frequency shifts by fitting the power spectrum of the atomic velocity projected into the
phonon modes coordinates into model-spectral-function shapes. As a first step the velocity is be projected into the point in thereciprocal space (wave vector) in which  the harmonic phonon modes are defined.
To calculate this power spectrum dynaphopy can use either <a href="http://mathworld.wolfram.com/FourierTransform.html">Fourier transform(FT) </a>, or <a href="http://cmm.cit.nih.gov/maxent/letsgo.html">Maximum Entropy(ME) methods</a>. FT is a robust method to calculate the power spectrum without information loss. On the other hand, ME is a fast method that approximates the power spectrum by accounting only for the most representative frequencies in the signal. Using ME method smoother power spectrums are obtained, which are easier to fit to model functions. However when the number of MD data is low usually the accuracy is lower than using FT. For this reason ME is recomended when working with large MD for high speed and FT is recommended when the available MD data is relatively low. 
 
<h3>Power spectra</h3>
<p>The power spectrum calculated by DynaPhoPy can be either plotted in screen or stored in a file. All power spectra calculated by DynaPhoPy are by default one sided. The selection of the algorithm used to calculate the power spectra is defined by <strong>-psm</strong> flag followed by algorithm number.
<br>At the present time there are 4 algorithms available:</p>
<UL>
<LI>0: Fourier transform algorithm (direct method).
<LI>1: Maximum Entropy Method algorithm.
<LI>2: Fast Fourier transform (using numpy).
<LI>3: Fast Fourier transform (using fftw).
<LI>4: Fast Fourier transform (using cuda).

</UL>
If not specified algorithm 1 is used.</em>

<pre><code>$ dynaphopy input_file TRAJECTORY -psm 1
</code></pre>
<p> Fourier methods do not require additional parameters but ME method does. This method allows to obtain smoother and faster 
power spectra interpolating the velocity using a polynomia which depends on a certain number of coefficents. The higher this number is, the heavier the calculation becomes and the result becomes closer to Fourier transfom solution. Usually the convergence of the peaks shape in ME is faund to be found around 1000-3000 coeficients obtaining a very good performance. By default the number of coefficents used is 1000 but it can be changed using <strong>-cf</strong> followed by the number of coeficients.</p>

<pre><code>$ dynaphopy input_file TRAJECTORY -cf 2000
</code></pre>

<UL>
<LI><h5>Full power spectra</h5>
<p> 
This options calculate the power spectrum of the autocorrelation function of the atomic velocity. That means that in principle it contains all the phonon frequencies present in the crystal. At infinite time steps and MD cell size limit, this power spectrum tends to the vibrational density of states (DOS).

<br><em>Notice that the super cell size limit is practically unreachable. This is <strong>not</strong> a good method at all to calculate the DOS. For this purpose is better to interpolate a larger set of q points within the Brillouin zone. Refere to <a href="#renormalized_forces">renormalized force constants</a> section. </em>

</p>
<p>Plot spectrum in a matplotlib X window:</p>
<pre><code>$ dynaphopy input_file TRAJECTORY -pd
</code></pre>
<p>Along with the full power spectrum, the DOS is also displayed for comparison. If 
    the renormalized force constants are calculated, also the DOS calculated with the renormalized force constants is shown. DOS is obtained interfacing with Phonopy.</p>    

<img src="images/full_projection_gan.png" alt="Interactive" style="width:630px">    
<em>Power spectrum of GaN at 300K calculated using maximum entropy method. MD has been computed using LAMMPS in a cell of 3456 atoms.</em>

<p>To save spectrum to file (DOS is not saved, for this purpose use phonopy) :</p>
<pre><code>$ dynaphopy input_file TRAJECTORY -sd filename
</code></pre>

When this spectrum is requested, the area bellow the curve is also calculated. This area correspond to the total kinetic energy of the phonon quasiparticle. According to the <a href="https://en.wikipedia.org/wiki/Equipartition_theorem">equipartition theorem</a>, at high temperatures this area may be approximated to:

</p>
<p style="text-align:center">
$$ \frac{1}2 N K_bT$$
</p>
where <em>N</em> is the number of phonon in the MD cell, <em>Kb</em> the <a href="https://en.wikipedia.org/wiki/Boltzmann_constant">Boltzmann constant</a> and <em>T</em> the temperature.

<LI><h5>Wave vector projection power spectra</h5>
<p>This options request the  velocity to be projected into a q point (wave vector) and obtain the power spectrum.
<p>Plot spectrum in a matplotlib X window:</p>
<pre><code>$ dynaphopy input_file OUTCAR -pw
</code></pre>
<p>Save spectrum to file:</p>
<pre><code>$ dynaphopy input_file TRAJECTORY -sw filename
</code></pre>

<br><em>Like in the full power spectrum calculation, this option also calculates the area of this spectrum. In this case, since the velocity has been projected, only contains the contribution of the phonon within the defined primitive cell.</em>
</p>

<LI><h5>Phonon modes projection power spectra</h5>
<p>This option requests the velocity to be projected into a q point (wave vector) and additionally
projected it into each of the harmonic phonon modes defined in this point. This option requieres phonopy to be correctly installed and 
<strong>FORCE_SETS</strong> file has to be calculated first. The result is a set of phonon mode projections (one for each phonon)
which are either displayed in the screen in different windows or stored in a file (one column for each phonon) sorted from lower 
to higher frequency.

<p>Plot spectrum in a matplotlib X window:</p>
<pre><code>$ dynaphopy input_file TRAJECTORY -pp
</code></pre>
<p>Save spectrum to file:</p>
<pre><code>$ dynaphopy input_file TRAJECTORY -sp filename
</code></pre>

<div id="additional_options"></div> 
<LI><h5>Additional options</h5>
<p>Use <strong>-r</strong> option to change the power spectrum range and resolution (start, end).</p>
<pre><code>$ dynaphopy input_file TRAJECTORY -r 25 100
</code></pre>
<p>The resolution of the power spectrum is defined by default to 0.05 THz. It can be changed by using <strong>--resolution</strong> option. Resolution is defined in THz. This option can also be modified using the interactive interface. 
<br>DynaPhoPy uses this value to optimize the calculation of the power spectra using FFT.  Changing this value may affect the precision of the power spectra.</p>
<pre><code>$ dynaphopy input_file TRAJECTORY --resolution 0.01
</code></pre>
<p>Use <strong>-q</strong> to change the recirpocal space point (wave vector) into which the velocity is projected. This option
takes 3 real numbers (wave vector in reduced coordinates).
<pre><code>$ dynaphopy input_file TRAJECTORY -q 0.5 0 0.5
</code></pre>

<p>The number of time steps used to calculate the power spectra may have great influence in the final result. Using more time steps will lead to more converged results, however, this will imply a increase of the computational time (specially for Fourier transform method. Additionally, usually the MD simulation will take some time to equilibrate. Those initial time steps can not be used and must be removed from the calculation. 
For this purpose DynaPhoPy includes some options to manipulate the input MD data.
The main one is <strong>-n</strong> flag. This flag defines the number of steps used in the calculations starting from the back. In other words, it will take the last N steps of the MD file.

<br><em>If the OUTCAR file contains less time steps than the especified in <strong>-n</strong> flag, all time steps will be used.</em></p>

<pre><code>$ dynaphopy input_file TRAJECTORY -n 5000
</code></pre>

<p>All these option can be combined. In interactive mode these options can also be used as initial 
parameters that can be changed inside by menus. The only exception is <strong>-n</strong> flag that can not be changed. 
For very long MD the amount of RAM memory needed to do the calculations can be huge so the initial discarted time steps are erased from memory at the begining of the execution.
<br><em>However, it is still necessary to keep the full MD trajectory in memory at the beginning before removing the initial steps. For detailed information about to work with huge MD data refere to special features</em>
</p>


</UL>

<h3>Phonon quasiparticle properties</h5>
<p> 
Phonon linewidhts and frequency shifts can be obtained by direct analysis of power spectra. Using phonon modes projections
are the best way to analize the individual phonons since they are completly separated in individual power spectra containing only
one peak. Dynaphopy offers a tool to automatically fit the
obtained spectra to lorentzian functions and display the results on the screen. This tool is called peak analysis and is
requested through flag <strong>-pa</strong>.
<br><em>This option works better with MEM method since the obtained sprectra are smoother. In case of Fourier trasform calculations
some smoothing methods may be used before fitting.</em>

<pre><code>$ dynaphopy input_file TRAJECTORY -pa
</code></pre>
<p> 
When the calculation is finished the individual information of each phonon (sorted from low to high frequency) is displayed on the screen. Position and Width correspond to the anharmonic frequency and linewidth of the corresponding phonon (in this case the 7th phonon) respectively. Frequency shifts are calculated from the diference between the harmonic frequency and calculated anharmonic frequency (Position) of each peak.
</p>
<pre><code>Peak # 7
------------------------------------------
Width (FWHM):                0.98920371 THz
Position:                    21.9736957 THz
Area (&lt;K&gt;) (Lorentzian):     0.05023055 eV
Area (&lt;K&gt;) (Total):          0.05062331 eV
<|dQ/dt|^2>      :           0.10092221 eV
Occupation number:           0.61054975
Fit temperature              1171.15374 K
Base line                    0.00012439 ev * ps
Maximum height:              0.10214808 eV * ps
Fitting global error :       0.03340609
Frequency shift:            -0.82162488 THz
Frequency shift (+T. exp.): -0.92346783 THz
</code></pre>
<p>
<br><strong>Width:</strong>	Phonon linewidth
<br><strong>Position:</strong> Anharmonic phonon frequency
<br><strong>Area:</strong> The integration of the power spectrum. This area is associated to the kinetic energy of the phonon mode. For quite harmonic systems, acording to the equipartiion theorem, at high temperature this area is expecte to be close to:
</p>
<p style="text-align:center">
$$ \frac{1}2 K_bT$$
</p>
However, due to the anharmonicity, this value may change. This temperature is calculated from the total power of the phonon-mode-projected projected power spectrum (area).
<br><strong><|dQ/dt|^2>:</strong> Time derivative of the phonon coordinate. Within the harmonic approximation, this value is equal to the total energy. In DynaPhoPy this value is calculated as double of the <strong>area</strong>.</p>

<p style="text-align:center">
$$ \left\langle E \right\rangle  = \left\langle K \right\rangle  + \left\langle V \right\rangle  = 2 \cdot \left\langle K \right\rangle  = \left\langle {{{\left| {\dot Q} \right|}^2}} \right\rangle  = {K_b}T $$
</p>

From this equation the temperature can be obtained. This value is shown in <strong>Fit Temperature</strong>.
<br><strong>Occupation number:</strong> Calculated from  <a href="https://en.wikipedia.org/wiki/Bose%E2%80%93Einstein_statistics">Bose-Einstein distribution</a>.</p>

<p style="text-align:center">
$$n = \frac{{\left\langle E \right\rangle }}{{\hbar \omega }} - \frac{1}{2}$$
</p>
assuming that 
<p style="text-align:center">
$$ \left\langle {{{\left| {\dot Q} \right|}^2}} \right\rangle = \left\langle E \right\rangle  $$
</p>
    where <em>n</em> is the occupation number and <em>&omega;</em> is the phonon frequency (<strong>Position</strong>).
<p>
<br><strong>Frequency shift:</strong> Difference between the anharmonic frequency (<strong>Position</strong>) and the harmonic frequency (obtained from phonopy).
<br><strong>Frequency shift (+T. exp.):</strong> Sum of the frequency shift calculated from the MD (described above) plus the frequency shift due to thermal expansion (calculated from the <a href="special.html#qha">QHA force constants</a>).
<br><strong>Fitting global error:</strong> Fitting error is calculated as the average of the standard errors of the position and the width divided by the squareroot of the area to make it dimensionless so it can be comparable between diferent peak sizes. The standard errors are obtained from the squareroot of the diagonal elements of the covariance matrix</p>
<p style="text-align:center">
$$ 
Global error = \frac{(e_p + e_w)}{2\sqrt(Area)}
$$
</p>
<br><p>By default, when the calculation is finished, a plot is shown for each phonon mode showing the fitting result for visual inspection. 
</p>    
<img src="images/peak_analysis_7.png" alt="Interactive" style="width:630px">
<p>
This is convenient for visual analysis of short MD trajectories, but when the calculations are long, specially using Fourier transform, or the calculations are done in cluster computers xwindows may be inconvinent.
In this case flag <strong>--silent</strong> can be used. Using this flag only the text data is shown in the screen and the phonon information wich can be stored redirecting the output to a file.   
</p>
<pre><code>$ dynaphopy input_file TRAJECTORY -pa --silent > output.log
</code></pre>
<UL>
<LI><h5>Fitting function selection</h5>
<p>You can select the function used to fit the power spectrum by option <strong>--fitting_function</strong> followed by the function number. If this option is not specified function number 0 is used. 
</p>
<p> 
<pre><code>$ dynaphopy input_file TRAJECTORY -pa --fitting_function 0
</code></pre>

<p> At the present time there are 3 functions available:
<p><strong>0: Lorentzian function</strong>
<br>This is the default fitting function
<p style="text-align:center">
$$ 
G(\omega) = \frac{A/\pi \gamma}{ 1+ [(\omega - \omega_0)/\gamma]^2}+C
$$
</p>    
    where <em>A</em> is the area under the curve, &omega;<sub>0</sub> is the peak center &gamma; the  width, and <em>C</em> the base line.
    
<br><strong>1: Asymmetric Lorentzian function</strong>
<br>

Sometimes phonon modes present a power spectrum with very asymmetric peaks, specially in soft phonon modes. These peaks can be fitted better usign asymmetric lorentzian functions. The asymmetric function used in DynaPhoPy is defined in this article[1] and is defined by:
</p>

<p style="text-align:center">
$$ 
G(\omega) = \frac{B/\pi \gamma(\omega)}{ 1+ [(\omega - \omega_0)/\gamma(\omega)]^2}+C
$$
</p>    
    where B is a fitting parameter and &gamma;(&omega;) the variable width defined as:
<p style="text-align:center">
$$ 
\gamma(\omega) = \frac{2 \gamma_0}{1+e^{a(\omega - \omega_0)}} 
$$
</p>
where <em> a </em> is the peak asymmetry. When <em> a = 0 </em> this function is equivalent to a Lorentzian function. 
DynaPhoPy calculates the phonon frequency (&omega;max) at the maximum of this asymmetric function which in general differe from &omega;<sub>0</sub>. Phonon linewidth is calculate as 2&gamma;(&omega;max).    

<img src="images/asymmetric_peak.png" alt="Interactive" style="width:630px">    
<br><strong>2: Damped harmonic oscillator</strong>
<br> This functions describes the theroretical power spectrum of a damped harmonic oscillator.
<p style="text-align:center">
$$ 
G(\omega) = \frac{B}{(\omega_0^2 - \omega^2)^2 + (\gamma * \omega)^2}+C
$$
</p>    

<em>[1] Stancik A L and  Brauns E B. A simple asymmetric lineshape for fitting infrared absorption spectra. Vibrational Spectroscopy, 47(1), 66–69 (2008)</em>
</UL>
    
<h3>Atomic displacements distribution</h3>
<p>
DynaPhoPy allows to calculate the atomic displacements distribution from the MD trajectory respect to a desired direction. 
The calculation of the atomic displacements requires (obviously) the previous load of the trajectory coordinates
information. In previous versions of DynaPhoPy, this trajectory was not stored in the hdf5 files, so if you load
the MD information from a hdf5 file, please make sure that contains also the trajectory coordinates. If not, you 
can use the lastest version of DynaPhoPy to extract the information from the OUTCAR file. The same can be applied 
for the use of <strong>concath5</strong> script.
<br>DynaPhoPy will still be compatible with hdf5 files which does not contain the trajectory and <strong>concath5</strong>
is able to create hdf5 files which contains only the velocity information using <strong>--velocity_only</strong> flag in 
order to reduce HD space.
<br>To request a atomic displacements calculation flags <strong>-pad</strong> and <strong>-sad</strong> are used,
using <strong>-pad</strong> option the atomic displacements distribution is shown in a matplolib plot:
</p>
<pre><code>$ dynaphopy input_file TRAJECTORY -pad 0 0 1
</code></pre>
<img src="images/atomic_displacements_mg.png" alt="Interactive" style="width:630px">
<p>
this flag requires a set of three float numbers that compose the vector that indicates the direction into which
the atomic displacements will be analyzed. This distribution is also fitted to a gaussian function.
The fitting parameters are shown on screen.
<pre><code>Atom 0, Element Mg
-----------------------------------------
Mean                      0.000023 Angstrom
Standard deviation        0.137539 Angstrom
Global fit error          0.000311
</code></pre>

<br>The atomic displacements are calculated respect to the equilibrium positions defined in the unit cell.
<strong>-sad</strong> option stores the atomic displacements distribution data into a file. This options takes four arguments corresponding to the direction vector and the file name.  
</p>
<pre><code>$ dynaphopy input_file TRAJECTORY -sad 0 0 1 displacements_file.out
</code></pre>
<p>
The file contains a column for each nonequivalent atom in the unit cell. The first column correspond to the displacement
coordinate.
</p>

<div id="anisotropic_displacement_parameters"></div> 
<h3>Anisotropic displacement parameters (ADP's)</h3>
<p> The anisotropic displacement parameters (ADP's) can be calculated from molecular dynamics trajectories using DynaPhoPy. These parameters can be used to represent the thermal allipsoids. At the present time DynaPhoPy do not draw the thermal ellipsoids but you can use one of the available visualization software to do this (e.g. vesta).
<br>This feature is only available by command line interface by using <strong>-adp</strong> option. 
</p>
<pre><code>$ dynaphopy input_file TRAJECTORY -adp</code></pre>
<p>
    ADP's are displayed in "unitvectors parallel to the basis vectors of reciproval space (UVRS)" coordinates. This coordinate system is used in popular file formats such CIF as mmCIF.
    </p>
<pre><code>             Anisotropic displacement parameters (uvrs)
          U11          U22          U33          U23          U13          U12
Mg    0.01904929   0.01927251   0.01901004   0.00034895  -0.00006727  -0.00017370
Mg    0.01904929   0.01927251   0.01901004   0.00034895  -0.00006727  -0.00017370
Mg    0.01904929   0.01927251   0.01901004   0.00034895  -0.00006727  -0.00017370
Mg    0.01904929   0.01927251   0.01901004   0.00034895  -0.00006727  -0.00017370
O     0.01828278   0.01837414   0.01803723   0.00015347   0.00010795  -0.00013897
O     0.01828278   0.01837414   0.01803723   0.00015347   0.00010795  -0.00013897
O     0.01828278   0.01837414   0.01803723   0.00015347   0.00010795  -0.00013897
O     0.01828278   0.01837414   0.01803723   0.00015347   0.00010795  -0.00013897
</code></pre>
    <p>
    ADP's are calculated respect to the average positions of the atoms in the MD. The average atomic positions can be obtained using DynaPhoPy by <strong>-average</strong> option: 
</p>
    <pre><code>$ dynaphopy input_file TRAJECTORY -average</code></pre>
    <p>
The translation crystal symmetry is applied in the calculation of the average positions acording to the unitcell and primitive matrix to calculate both the ADP and the average structure.

    
<div id="renormalized_forces"></div> 
<h3>Renormalized force constants</h3>
<p> The phonon information that can be obtained from MD is limited to the size of the simulation cell.
DynaPhoPy can only extract the information on the commensurate points so in order to obtain a good sampling
of the Brillouin zone to calculate crystal macroscopical properties it is necessary to resort to interpolation methods.
<br>Phonopy now can renormalize the force constants from a set of renormalized frequencies at the commensurate points. 
DynaPhoPy interfaces with phonopy to provide a new set of renormalized frequencies extracted from MD for all commensurate points and obtain the renormalized force constants from phonopy using <strong>-sfc</strong> flag.</p>
<pre><code>$ dynaphopy input_file TRAJECTORY --sfc FORCE_CONSTANTS
</code></pre>
<p>
 
These force constants are written in a FORCE_CONSTANTS file that can be used in phonopy instead of the FORCE_SETS file by <strong>--readfc</strong> flag.

<pre><code>$ phonopy --readfc FORCE_CONSTANTS
</code></pre>
<p>
 
To enforce space group symmetry to force constants use option <strong>--fcsymm</strong>. This option can only be set by command line. If you want to use this feature in interactive, load it in the execution command using <strong>--fcsymm</strong> flag. 

<pre><code>$ phonopy --readfc FORCE_CONSTANTS --fcsymm
</code></pre>

<p>

Using this new force constants it is possible to calculate all the properties available in phonopy using a set of renormalized force constants obtained at finite temperature. One of the most intersting applications is the renormalization of imaginary frequencies in materials that are stable at high temperatures but inestable at 0 K. 
</p>
<img src="images/renormalized_phonon_dispersion.png" alt="Interactive" style="width:630px">
<p style="text-align:center">
<em>Phonon dispersion bands of cubic zirconia (ZrO2) renormalized at 1000 K </em>
</p>
    <p><strong>Important note</strong>: The commensurate points used in the calculation of the renormalized force constants coresponds to the commensurate points in the cell defined in <a href="usage.html#phonopy_matrix">PHONOPY SUPERCELL</a>. That means that in order to obtain a good renormalized force constants the commensurate points in PHONOPY SUPERCELL should be also commensurate in the MD simulation cell. Usually that menans that MD simulation cell should be a multiple of PHONOPY SUPERCELL. This behavior can be changed by option <strong>--MD_commensurate</strong>
    </p>
    <pre><code>$ dynaphopy --sfc FORCE_CONSTANTS --MD_commensurate
</code></pre>  
    <p>Using this option the commensurate points of the MD simulation cell are used. Non comensurate points in the PHONOPY CELL are interpolated to calculate the projected power spectra. Notice that the dimension of the force constants change respect to the harmonic force constants to meet the dimensions of the MD simulation cell. Using large MD simulation cells in very symmetric crystals may greatly increase the number of commensurate points.</p>
    
<div id="symmetry"></div> 
<h3>Crystallographic symmetry</h3>
    <p> DynaPhoPy uses crystallographic symmetry to determine the equivalent q-ponts in the MD supercell (k-star). This information is used to average the power spectra of all the equivalent q-points to increase the precision of the phonon properties calculation. Dynaphopy also uses phonopy to determine the degenerate phonon modes and average their power spectra to increase the precision. Symmetry use can be deactivated using the option <strong>--no_symmetry</strong>.     
    </p>
    <pre><code>$ dynaphopy input_file TRAJECTORY --no_symmetry</code></pre>
    <p>
<div id="Stquasiparticla data"></div> 
<h3>Quasiparticle phonon data</h3>
    <p> The quasiparticle phonon frequencies and linewidths obtained from <em>peak analysis</em> at all commensurate points can be stored in a yaml format file by using <strong>-sdata</strong> flag. This information is the same used to calculate the renormalized force constants. This option does not require any previous force constants calculation.</p>
<p>
<pre><code>$ dynaphopy input_file TRAJECTORY -sdata</code></pre>
<p>
    The date will be stored in a file named <strong>quasiparticle_data.yaml</strong>. This information i</p>

<div id="Non-analytic corrections"></div> 
<h3>Non-analytic corrections</h3>
    <p> Non-analytic corrections can be added via a <strong>BORN</strong> file (phonopy format) that is placed in the work directory with name: <strong>BORN</strong>. This option can be enabled in the interactive interface or using tag <strong>--nac</strong>.</p>
<p>
<pre><code>$ dynaphopy input_file TRAJECTORY --nac</code></pre>
<p>
    </p>

<div id="thermal"></div> 
<h3>Thermal properties</h3>
    <p> Constant volume themal properties are calculated from de renormalized DOS using quasiparticle theory. These properties include free energy, entropy, heat capacity (Cv) and total energy. As reference DynaPhoPy also calculates the thermal properties using the harmonic DOS.
        <br>To request the calculation of the thermal properties use <strong>-thm</strong>. Alternaltivelly this calculation can be requested using the interactive interface.
    </p>
    
    <pre><code>$ dynaphopy input_file TRAJECTORY -thm</code></pre>
    
    <p>Thermal properites are calculated per unit cell. By default when thermal properites are shown also a plot with the DOS calculated using the harmonic force constants and renormalized force constants is displayed. To not show <strong>--silent</strong> option.</p>
    <pre><code>Thermal properties per unit cell (746.93 K) [From DoS]
----------------------------------------------
                            Harmonic    Quasiparticle

Free energy   (KJ/mol):    -232.8661     -237.1722
Entropy      (J/K/mol):     512.6232      518.3902
Cv           (J/K/mol):     198.1759      198.2365
Total energy  (KJ/mol):     150.0030      150.0008
Integration:                  0.9998        0.9999
</code></pre>
<p>
    <strong>Integration</strong> corresponds to the total integral of the DOS (from 0 to infinity) normalized to one phonon mode. This value should be very close to 1. If this is not true you may need to increase the resolution of the power spectrum. The integration of the DOS to calculate the thermal properties is done within the range defined for the power spectrum, make sure that this range includes all the spectral density. 
</p>

<img src="images/CdTe_thm.png" alt="Interactive" style="width:630px">
    <p>
        The temperature is a parameter needed to calculate the themal properties. By default it is obtained by Maxwell-Boltzmann analysis, but can be set by <strong>--temperature</strong>. This option requires a numeric value corresponding to the temperature in Kelvin. It is <strong>specially recomended</strong> to use this option when the MD simulation cell is relativelly small and Maxwell-Boltzmann analysis is not able to reproduce the temperature correctly. 
        This option also works in the calculation is requested via interactive interface but can not be changed once the interactive interface is launched.
    </p>
    <pre><code>$ dynaphopy input_file TRAJECTORY -thm --temperature 800</code></pre>
    <p>The DOS can be also calculated directly from the full power spectrum. However, in order to have a good phonon modes sampling it is necessary to use a very large supercell to calculate the MD. To request the calculation of the DOS and thermal properties from the power spectrum use <strong>--thm_full</strong>. This option can not be requested using interactive interface. 
    </p>
    <pre><code>$ dynaphopy input_file TRAJECTORY --thm_full</code></pre>
    <p></p>
    <pre><code>Thermal properties per unit cell (798.74 K) [From DoS]
----------------------------------------------
                             Harmonic    Renormalized   Power spectrum

Free energy   (KJ/mol):     -83.2447      -93.3198      -89.5185
Entropy      (J/K/mol):     311.6827      319.3117      315.6884
Cv           (J/K/mol):     191.8066      189.6462      189.1828
Total energy (KJ//mol):     165.7074      161.7258      162.6330
Integration:                  1.0000        1.0000        0.9838
</code></pre>
<p>Obtaining a good DOS directly from the power is usually dificult and requieres a large MD simulation cell and long simulation times. That makes that usually the integration of the DOS is not 1 and may affect the calculated thermal properties. To avoid this problem the DOS can be forced to be normalized to 1. This is done by using option <strong>--normalize_dos</strong>. It is strongly recommended to use this option specially at low temperatures.
</p>
<pre><code>$ dynaphopy input_file TRAJECTORY --thm_full --normalize_dos</code></pre>
    <p>Be carefull: The calculation of the DoS is affected by other options defined in <a href="#additional_options">power spectra</a> and <a href="#renormalized_forces">renormalized force constants</a> sections.  
</p>
    
    
    </section>
    </div>
    
    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Dynaphopy maintained by <a href="https://github.com/abelcarreras">abelcarreras</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>
    
  </body>
</html>